{"version":3,"file":"addlink.min.js","sources":["../src/addlink.js"],"sourcesContent":["import $ from 'jquery';\r\nimport ModalForm from 'core_form/modalform';\r\nimport ModalDeleteCancel from 'core/modal_delete_cancel';\r\nimport ModalEvents from 'core/modal_events';\r\nimport {getString} from 'core/str';\r\nimport {deleteLinkmanItem} from './repository';\r\nimport Notification from \"core/notification\";\r\n\r\nconst Selectors = {\r\n    addBtn: '.linkman-add',\r\n    linkmanTable: 'linkman-table',\r\n    editBtn: '[data-action=\"linkman-item-edit\"]',\r\n    deleteBtn: '[data-action=\"linkman-item-delete\"]'\r\n};\r\n\r\nasync function getDeleteForm(element) {\r\n    const id = element.getAttribute('data-id');\r\n    const modal = await ModalDeleteCancel.create({\r\n        title: 'Delete external link',\r\n        body: getString('confirmdelete', 'local_linkman'),\r\n    });\r\n    modal.getRoot().on(ModalEvents.delete, (e) => {\r\n        const promise = deleteLinkmanItem(id);\r\n        promise.then(result => {\r\n            if(result.success) {\r\n                setTimeout(function() {\r\n                    location.reload();\r\n                }, 200);\r\n            } else {\r\n                Notification.addNotification({\r\n                    message: \"Error when deleting external link.\",\r\n                    type: 'error'\r\n                })\r\n            }\r\n        }).catch( error => {\r\n            Notification.exception(new Error('Error when dealing with webservice.'));\r\n        })\r\n    })\r\n    return modal;\r\n}\r\n\r\nfunction showForm(e, type) {\r\n    e.preventDefault();\r\n    const element = e.target;\r\n    switch (type) {\r\n        case 'ADD_FORM':\r\n            const modalForm = getAddForm(element);\r\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, event => {\r\n                setTimeout(function() {\r\n                    location.reload();\r\n                }, 200);\r\n            });\r\n            // Show the form.\r\n            modalForm.show();\r\n            break;\r\n        case 'EDIT_FORM':\r\n            const editForm = getEditForm(element);\r\n            editForm.addEventListener(editForm.events.FORM_SUBMITTED, event => {\r\n                setTimeout(function() {\r\n                    location.reload();\r\n                }, 200);\r\n            });\r\n            // Show the form.\r\n            editForm.show();\r\n            break;\r\n        case 'DELETE_FORM':\r\n            const deleteFormPromise = getDeleteForm(element);\r\n            // Show the form.\r\n            deleteFormPromise.then((deleteForm) => deleteForm.show());\r\n            break;\r\n    }\r\n}\r\n\r\nfunction getAddForm(element) {\r\n    return new ModalForm({\r\n        formClass: \"local_linkman\\\\form\\\\link_add_form\",\r\n        // Add as many arguments as you need, they will be passed to the form:\r\n        args: {action: \"ADD_ITEM\"},\r\n        // Pass any configuration settings to the modal dialogue, for example, the title:\r\n        modalConfig: {title: \"Add external link\"},\r\n        // DOM element that should get the focus after the modal dialogue is closed:\r\n        returnFocus: element,\r\n    });\r\n}\r\n\r\nfunction getEditForm(element) {\r\n    const id = element.getAttribute('data-id');\r\n    const name = element.getAttribute('data-name');\r\n    const base_link = element.getAttribute('data-baselink');\r\n    const note = element.getAttribute('data-note');\r\n    return new ModalForm({\r\n        formClass: \"local_linkman\\\\form\\\\link_add_form\",\r\n        // Add as many arguments as you need, they will be passed to the form:\r\n        args: {action: \"EDIT_ITEM\", data: {id, name, base_link, note}},\r\n        // Pass any configuration settings to the modal dialogue, for example, the title:\r\n        modalConfig: {title: \"Edit external link\"},\r\n        // DOM element that should get the focus after the modal dialogue is closed:\r\n        returnFocus: element,\r\n    });\r\n}\r\n\r\nfunction init() {\r\n    $(Selectors.addBtn).on('click',e => {\r\n        showForm(e, 'ADD_FORM')\r\n    });\r\n    $(Selectors.editBtn).on('click',e => {\r\n        showForm(e, 'EDIT_FORM')\r\n    });\r\n    $(Selectors.deleteBtn).on('click',e => {\r\n        showForm(e, 'DELETE_FORM')\r\n    })\r\n}\r\n\r\nexport default {\r\n    init\r\n}"],"names":["Selectors","showForm","e","type","preventDefault","element","target","modalForm","ModalForm","formClass","args","action","modalConfig","title","returnFocus","getAddForm","addEventListener","events","FORM_SUBMITTED","event","setTimeout","location","reload","show","editForm","id","getAttribute","name","base_link","note","data","getEditForm","deleteFormPromise","modal","ModalDeleteCancel","create","body","getRoot","on","ModalEvents","delete","then","result","success","addNotification","message","catch","error","exception","Error","getDeleteForm","deleteForm","init"],"mappings":"wrBAQMA,iBACM,eADNA,kBAGO,oCAHPA,oBAIS,+CA6BNC,SAASC,EAAGC,MACjBD,EAAEE,uBACIC,QAAUH,EAAEI,cACVH,UACC,iBACKI,mBA2BEF,gBACT,IAAIG,mBAAU,CACjBC,UAAW,qCAEXC,KAAM,CAACC,OAAQ,YAEfC,YAAa,CAACC,MAAO,qBAErBC,YAAaT,UAnCSU,CAAWV,SAC7BE,UAAUS,iBAAiBT,UAAUU,OAAOC,gBAAgBC,QACxDC,YAAW,WACPC,SAASC,WACV,QAGPf,UAAUgB,iBAET,kBACKC,kBA6BGnB,eACXoB,GAAKpB,QAAQqB,aAAa,WAC1BC,KAAOtB,QAAQqB,aAAa,aAC5BE,UAAYvB,QAAQqB,aAAa,iBACjCG,KAAOxB,QAAQqB,aAAa,oBAC3B,IAAIlB,mBAAU,CACjBC,UAAW,qCAEXC,KAAM,CAACC,OAAQ,YAAamB,KAAM,CAACL,GAAAA,GAAIE,KAAAA,KAAMC,UAAAA,UAAWC,KAAAA,OAExDjB,YAAa,CAACC,MAAO,sBAErBC,YAAaT,UAzCQ0B,CAAY1B,SAC7BmB,SAASR,iBAAiBQ,SAASP,OAAOC,gBAAgBC,QACtDC,YAAW,WACPC,SAASC,WACV,QAGPE,SAASD,iBAER,oBACKS,iCAnDW3B,eACnBoB,GAAKpB,QAAQqB,aAAa,WAC1BO,YAAcC,6BAAkBC,OAAO,CACzCtB,MAAO,uBACPuB,MAAM,kBAAU,gBAAiB,0BAErCH,MAAMI,UAAUC,GAAGC,sBAAYC,QAAStC,KACpB,iCAAkBuB,IAC1BgB,MAAKC,SACNA,OAAOC,QACNvB,YAAW,WACPC,SAASC,WACV,2BAEUsB,gBAAgB,CACzBC,QAAS,qCACT1C,KAAM,aAGf2C,OAAOC,8BACOC,UAAU,IAAIC,MAAM,8CAGlChB,MA4B2BiB,CAAc7C,SAExC2B,kBAAkBS,MAAMU,YAAeA,WAAW5B,uBA6C/C,CACX6B,oCAZEpD,kBAAkBsC,GAAG,SAAQpC,IAC3BD,SAASC,EAAG,mCAEdF,mBAAmBsC,GAAG,SAAQpC,IAC5BD,SAASC,EAAG,oCAEdF,qBAAqBsC,GAAG,SAAQpC,IAC9BD,SAASC,EAAG"}