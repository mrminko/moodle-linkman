define("local_linkman/addlink",["exports","jquery","core_form/modalform","core/modal_delete_cancel","core/modal_events","core/str","./repository","core/notification"],(function(_exports,_jquery,_modalform,_modal_delete_cancel,_modal_events,_str,_repository,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_modalform=_interopRequireDefault(_modalform),_modal_delete_cancel=_interopRequireDefault(_modal_delete_cancel),_modal_events=_interopRequireDefault(_modal_events),_notification=_interopRequireDefault(_notification);const Selectors_addBtn=".linkman-add",Selectors_editBtn='[data-action="linkman-item-edit"]',Selectors_deleteBtn='[data-action="linkman-item-delete"]';function showForm(e,type){e.preventDefault();const element=e.target;switch(type){case"ADD_FORM":const modalForm=function(element){return new _modalform.default({formClass:"local_linkman\\form\\link_add_form",args:{action:"ADD_ITEM"},modalConfig:{title:"Add external link"},returnFocus:element})}(element);modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(event=>{setTimeout((function(){location.reload()}),200)})),modalForm.show();break;case"EDIT_FORM":const editForm=function(element){const id=element.getAttribute("data-id"),name=element.getAttribute("data-name"),base_link=element.getAttribute("data-baselink"),note=element.getAttribute("data-note");return new _modalform.default({formClass:"local_linkman\\form\\link_add_form",args:{action:"EDIT_ITEM",data:{id:id,name:name,base_link:base_link,note:note}},modalConfig:{title:"Edit external link"},returnFocus:element})}(element);editForm.addEventListener(editForm.events.FORM_SUBMITTED,(event=>{setTimeout((function(){location.reload()}),200)})),editForm.show();break;case"DELETE_FORM":const deleteFormPromise=async function(element){const id=element.getAttribute("data-id"),modal=await _modal_delete_cancel.default.create({title:"Delete external link",body:(0,_str.getString)("confirmdelete","local_linkman")});return modal.getRoot().on(_modal_events.default.delete,(e=>{(0,_repository.deleteLinkmanItem)(id).then((result=>{result.success?setTimeout((function(){location.reload()}),200):_notification.default.addNotification({message:"Error when deleting external link.",type:"error"})})).catch((error=>{_notification.default.exception(new Error("Error when dealing with webservice."))}))})),modal}(element);deleteFormPromise.then((deleteForm=>deleteForm.show()))}}var _default={init:function(){(0,_jquery.default)(Selectors_addBtn).on("click",(e=>{showForm(e,"ADD_FORM")})),(0,_jquery.default)(Selectors_editBtn).on("click",(e=>{showForm(e,"EDIT_FORM")})),(0,_jquery.default)(Selectors_deleteBtn).on("click",(e=>{showForm(e,"DELETE_FORM")}))}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=addlink.min.js.map